# =============================================================================
# SOURCES.YML - dbt Source Definitions for Across Analytics
# =============================================================================

version: 2

sources:
  # =========================================================================
  # ARBITRUM SOURCE
  # =========================================================================
  - name: raw_arbitrum
    description: |
      Raw blockchain logs from Arbitrum, loaded by the ETL pipeline.
      Contains FundsDeposited, FilledRelay, and ExecutedRelayerRefundRoot events.
    database: across_analytics  # Your PostgreSQL database name
    schema: raw                 # Schema where raw tables live
    
    # Freshness configuration: dbt will check if data is recent enough
    # Run: dbt source freshness
    freshness:
      warn_after: {count: 24, period: hour}   # Warn if no new data in 24h
      error_after: {count: 48, period: hour}  # Error if no new data in 48h
    
    # Which column contains the "loaded at" timestamp
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: arbitrum_logs_processed
        description: |
          Processed blockchain logs from Arbitrum containing:
          - FundsDeposited events (deposits initiated)
          - FilledRelay events (deposits filled by relayers)
          - ExecutedRelayerRefundRoot events (relayer reimbursements)
          
          Loaded by: src/etl/load/load_logs_processed_to_database.py
          Source: Alchemy API → Parquet → PostgreSQL
        
        columns:
          - name: transactionHash
            description: "Unique transaction identifier on the blockchain"
            tests:
              - not_null
          
          - name: timestamp_datetime
            description: "When the event occurred (block timestamp)"
            tests:
              - not_null
          
          - name: topic_0
            description: "Event signature hash (identifies event type)"
            tests:
              - not_null

  # =========================================================================
  # ETHEREUM SOURCE
  # =========================================================================
  - name: raw_ethereum
    description: |
      Raw blockchain logs from Ethereum mainnet, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: ethereum_logs_processed
        description: |
          Processed blockchain logs from Ethereum mainnet.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
          Source: Etherscan API → Parquet → PostgreSQL
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # POLYGON SOURCE
  # =========================================================================
  - name: raw_polygon
    description: |
      Raw blockchain logs from Polygon, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: polygon_logs_processed
        description: |
          Processed blockchain logs from Polygon.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # BASE SOURCE
  # =========================================================================
  - name: raw_base
    description: |
      Raw blockchain logs from Base, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: base_logs_processed
        description: |
          Processed blockchain logs from Base.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # BSC SOURCE
  # =========================================================================
  - name: raw_bsc
    description: |
      Raw blockchain logs from BNB Smart Chain (BSC), loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: bsc_logs_processed
        description: |
          Processed blockchain logs from BSC.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # OPTIMISM SOURCE
  # =========================================================================
  - name: raw_optimism
    description: |
      Raw blockchain logs from Optimism, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: optimism_logs_processed
        description: |
          Processed blockchain logs from Optimism.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # LINEA SOURCE
  # =========================================================================
  - name: raw_linea
    description: |
      Raw blockchain logs from Linea, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: linea_logs_processed
        description: |
          Processed blockchain logs from Linea.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # WORLDCHAIN SOURCE
  # =========================================================================
  - name: raw_worldchain
    description: |
      Raw blockchain logs from Worldchain, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: worldchain_logs_processed
        description: |
          Processed blockchain logs from Worldchain.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # UNICHAIN SOURCE
  # =========================================================================
  - name: raw_unichain
    description: |
      Raw blockchain logs from Unichain, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: unichain_logs_processed
        description: |
          Processed blockchain logs from Unichain.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # HYPEREVM SOURCE
  # =========================================================================
  - name: raw_hyperevm
    description: |
      Raw blockchain logs from HyperEVM, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: hyperevm_logs_processed
        description: |
          Processed blockchain logs from HyperEVM.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null

  # =========================================================================
  # MONAD SOURCE
  # =========================================================================
  - name: raw_monad
    description: |
      Raw blockchain logs from Monad, loaded by the ETL pipeline.
    database: across_analytics
    schema: raw
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    loaded_at_field: timestamp_datetime
    
    tables:
      - name: monad_logs_processed
        description: |
          Processed blockchain logs from Monad.
          Loaded by: src/etl/load/load_logs_processed_to_database.py
        columns:
          - name: transactionHash
            tests:
              - not_null
          - name: timestamp_datetime
            tests:
              - not_null
